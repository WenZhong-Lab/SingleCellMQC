---
title: "cellqc"
output: html_document
---
# Cell-level QC 
## Cell summary {.tabset }

```{r cell_qc_overview, echo=FALSE, results='asis', warning=FALSE, message=FALSE }
  generate_primary_card(
  header_content = "**Key components overview: **",
    card_title =NULL,
  body_content = "
- **QC scatter plot:** Key cell metrics distribution for each sample. 
- **Low quality cell information:** Summary of the results of different low-quality cell detection methods.
- **Doublet information:** Summary of the results of different doublet detection methods.
  "
  )
```




```{r cell scatter plot, echo=FALSE, results='asis', message=FALSE, warning=FALSE}

if(!is.null(data$Cell$Section1$scatter)){
  cat('### QC scatter plot {.tabset .unnumbered .tabset-dropdown} \n')
  cat('\n\n')
  for (i in data$Cell$Section1$scatter) {
    name <- paste(unlist(stringr::str_split(i, "_")), collapse = " ")
    cat(paste0("#### ", name, " {.tabset .tabset-dropdown .unnumbered}\n"))
    cat("![](", paste0(cell_dir, "/Cell_QC/LowCell/scatter/",  paste0(i,".png")), ")")
    cat('\n\n')
  }
}

```


```{r Filtered pct, echo=FALSE, results='asis', message=FALSE, warning=FALSE}

if(!is.null(data$Cell$Section1$scatter) | !is.null(data$Cell$Section1$lq_Filtration) | !is.null(data$Cell$Section1$lq_upset) ){
    
    
    cat("
### Low quality cell information {.tabset .unnumbered}

Low quality cells, especially dead or damaged cells, typically exhibit high mitochondrial RNA content, low UMI counts, and a reduced number of detected genes. Cells with unusually abundant isotype counts in ADT sequencing are also considered poor quality, often due to non-specific antibody binding or contamination. The detection of low-quality cells plays an important part in sequencing data quality control. This section will help you quickly overview the basics information of different low-quality detection methods.

")
 cat('\n\n') 
}


if(!is.null(data$Cell$Section1$lq_Filtration)){
  cat('#### Summary tables {.tabset .unnumbered} \n')

  subchunkify(data$Cell$Section1$lq_pre_post, seed="low_pre_post")

  subchunkify(data$Cell$Section1$lq_Filtration$pct,seed="low_pct")

  subchunkify(data$Cell$Section1$lq_Filtration$count,seed="low_count")

  
  cat('\n\n')
}  
  
if(!is.null(data$Cell$Section1$lq_upset)){
  cat('#### Method upset plot {.tabset .unnumbered} \n')
  subchunkify(data$Cell$Section1$lq_upset,6.5, 8,seed="low_upset1")
  cat('\n\n')
  cat("This upset plot shows the overlap between different methods. Only 20 numbers of intersections are shown. \n")
  cat('\n\n')
}  

```



```{r Doublet, echo=FALSE, results='asis', message=FALSE, warning=FALSE}
if(!is.null(data$Cell$Section2$db_Filtration) | !is.null(data$Cell$Section2$db_upset)){
    cat("
### Doublet information {.tabset .unnumbered}

Another key issue in cell QC is the detection of doublets, which can affect the annotation accuracy of cell types. This section will help you quickly check the basic information of different doublet detection methods. This section contains two aspects:

")
  cat('\n\n')
}

if(!is.null(data$Cell$Section2$db_Filtration)){
  
  cat('#### Summary tables {.tabset .unnumbered} \n')
  subchunkify(data$Cell$Section2$db_pre_post, seed="db_pre_post")

  subchunkify(data$Cell$Section2$db_Filtration$pct,seed="db_pct")

  subchunkify(data$Cell$Section2$db_Filtration$count,seed="db_count")

  
  cat('\n\n')
}  
  
if(!is.null(data$Cell$Section2$db_upset)){
  cat('#### Method upset plot {.tabset .unnumbered} \n')
  subchunkify(data$Cell$Section2$db_upset,6.5, 8,seed="db_upset")
  cat('\n\n')
  cat("This upset plot shows the overlap between different methods. Only 20 numbers of intersections are shown. \n")
  cat('\n\n')
}  

```



